// EDIT USER API
// Complete
app.put('/api/editUser', async (req, res, next) => 
{    
    var error = '';

    const {firstName, lastName, username, password, phone, email, major} = req.body;

    const db = client.db("StudyBuddy");
    db.collection('users').findOneAndUpdate({username:username}, { $set: {
        "firstName":firstName,
        "lastName":lastName,
        "password":password,
        "phone":phone,
        "email":email,
        "major":major,
    } })
    
    var ret = {
        firstName:firstName,
        lastName:lastName,
        username:username,
        password:password,
        phone:phone,
        email:email,
        major:major,
        error:'' };
    res.status(200).json(ret);
});
 
    // Complete
app.put('/api/addClasses', async (req, res, next) => 
{    
    var error = '';

    const {username, class0, class1, class2, class3, class4, class5} = req.body;

    const db = client.db("StudyBuddy");
    db.collection('users').findOneAndUpdate({username:username}, { $set: {
        "classesTaking.0":class0,
        "classesTaking.1":class1,
        "classesTaking.2":class2,
        "classesTaking.3":class3,
        "classesTaking.4":class4,
        "classesTaking.5":class5
    } })

    var ret = {
        error:'' };
    res.status(200).json(ret);
});

// DELETE USER API
// Works Yay! Needs fine tuning.
// Wait until all APIs are complete to implement JWT.
app.delete('/api/deleteUser', async (req, res, next) => 
{
    var error = '';
  
    const {username} = req.body;

    const db = client.db("StudyBuddy");
    db.collection('users').deleteOne({username:username});
  
    var ret = {error:error};
    res.status(200).json(ret);
});


// EDIT USER API
// Error 404 Not Found.
// Wait until all APIs are complete to implement JWT.
app.put('/api/editGroup', async (req, res, next) => 
{    
    var error = '';

    const {groupName, course, description, dates, time, location} = req.body;

    const db = client.db("StudyBuddy");
    db.collection('groups').findOneAndUpdate({groupName:groupName}, { $set: {
        "course":course,
        "description":description,
        "dates":dates,
        "time":time,
        "location":location
    } })
    
    var ret = {
        groupName:groupName,
        course:course,
        description:description,
        dates:dates,
        time:time,
        location:location,
        error:'' };
    res.status(200).json(ret);
});
    
// Ratings
app.put('/api/editRating', async (req, res, next) => 
{    
     var error = '';

    const {username, groupName, rating} = req.body;

    const db = client.db("StudyBuddy");
    db.collection('groups').updateOne({groupName:groupName}, { $push: {
        "reviews":rating
    } })

    var ret = {
        error:'' };
    res.status(200).json(ret);
});

// DELETE GROUP API
// Works Yay! Needs fine tuning.
// Wait until all APIs are complete to implement JWT.
app.delete('/api/deleteGroup', async (req, res, next) => 
{
    var error = '';
  
    const {groupName} = req.body;

    const db = client.db("StudyBuddy");
    db.collection('groups').deleteOne({groupName:groupName});
  
    var ret = {error:error};
    res.status(200).json(ret);
});
}